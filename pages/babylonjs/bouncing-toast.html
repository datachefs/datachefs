<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="utf-8"/>
    <title>Babylon - Getting Started</title>
    <!--- Link to the last version of BabylonJS --->
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <style>
        html, body {
            overflow: hidden;
            width   : 100%;
            height  : 100%;
            margin  : 0;
            padding : 0;
        }

        #renderCanvas {
            width   : 100%;
            height  : 100%;
            touch-action: none;
        }
    </style>
</head>
<body>
    <canvas id="renderCanvas"></canvas>
    <script>
        window.addEventListener('DOMContentLoaded', function(){
            // get the canvas DOM element
            var canvas = document.getElementById('renderCanvas');


function delayCreateScene() {
    var scene = new BABYLON.Scene(engine);

    engine.setHardwareScalingLevel(0.5);

    // Load the model
    BABYLON.SceneLoader.Append("https://models.babylonjs.com/", "toast_acrobatics.glb", scene, function (meshes) {
        // Resize the model
        scene.meshes[0].scaling.scaleInPlace(100)
        
        // Create a camera pointing at your model.
        scene.createDefaultCameraOrLight(true, true, true);
        scene.activeCamera.useAutoRotationBehavior = true;
        scene.activeCamera.radius = 90
        scene.activeCamera.lowerRadiusLimit = 15;
        scene.activeCamera.upperRadiusLimit = 180;
        scene.activeCamera.inertialAlphaOffset = 1.57
        scene.activeCamera.inertialBetaOffset = -0.02
        
        // Create skybox
        var helper = scene.createDefaultEnvironment({
        });   

        // Create acrylic material
        var mat = new BABYLON.StandardMaterial("", scene);
        mat.disableLighting = true;
        var rtt = new BABYLON.RenderTargetTexture("", 512);
        rtt.renderList = [];
        // First we blur
        var blurV = new BABYLON.BlurPostProcess("", new BABYLON.Vector2(0, 1), 64, 0.6, undefined, undefined, engine);
        var blurH = new BABYLON.BlurPostProcess("", new BABYLON.Vector2(1, 0), 64, 0.6, undefined, undefined, engine);      
        rtt.addPostProcess(blurH);
        rtt.addPostProcess(blurV);
        mat.refractionTexture = rtt;
        // Then we tint
        mat.imageProcessingConfiguration = new BABYLON.ImageProcessingConfiguration();
        mat.imageProcessingConfiguration.colorCurvesEnabled = true;
        var curve = new BABYLON.ColorCurves();
        curve.globalHue = 70;
        curve.globalDensity = 80;
        curve.globalSaturation = 20;
        mat.imageProcessingConfiguration.colorCurves = curve;
        // Add all meshes to be blurred
        for (var i = 0; i < scene.meshes.length; i++) {
            rtt.renderList.push(scene.meshes[i]);   
        }

        // Create acrylic plane in front of the model
        var plane = BABYLON.Mesh.CreatePlane("", 28, scene, false, BABYLON.Mesh.DOUBLESIDE);
        plane.position = new BABYLON.Vector3(-23, 14, 15);
        plane.material = mat;
    });

    return scene;
}


        
var engine = new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true });
        var scene = delayCreateScene();

        engine.runRenderLoop(function () {
            if (scene) {
                scene.render();
            }
        });

        // Resize
        window.addEventListener("resize", function () {
            engine.resize();
        });
    </script>
</body>
</html>
